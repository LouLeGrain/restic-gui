{{define "content"}}
<div id="indexApp">
    <h2>{{.Title}}</h2>
    <div id="indexApp"></div>
    <noscript><h2>Javascript needs to be enabled to send the payment!</h2></noscript>
    <div class="row">
        <div class="col-md-4">
        {{ range $key, $value := .Repos }}
            <div class="list-group repos">
                <a href="" class="list-group-item  list-group-item-action list-group-item-primary"
                   id="repo_{{$key}}">Backup: {{ $value.Path }}</a>
                <div class="list-group backups" style="margin-bottom: 1em">
                {{ range $k, $v := $value.Backups }}
                    <a href="" class="list-group-item backup list-group-item-action list-group-item-primary"
                       id="bu_{{$k}}">Source: {{$v.Source}}</a>
                    <div class="list-group snapshots"></div>
                {{end}}
                </div>
            </div>
        {{end}}
        </div>
        <div class="col-md-8">
            Details
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {

        $('a').click(function (e) {
            e.preventDefault()
            console.log($(this).attr('id'))
            $(this).tab('show')

        })

        var backups = JSON.parse('{{.Data}}');
        console.log(backups)
        /*

                showDetail(0);

                function showDetail(idx) {
                    var type = backups[idx].repoType;
                    //console.log(backups[idx])
                    $('#formBuName').val(backups[idx].backupName);
                    $('#formBuPath').val(backups[idx].backupPath);
                    $('#formRepoPath').val(backups[idx].repoPath);
                    $('#formRepoPasswd').val(backups[idx].repoPasswd);
                    $("input[name=type][value=" + type + "]").prop("checked", true);
                    checkValidPath(backups[idx].backupPath);
                }

                $("#formBuPath").blur(function (e) {
                    checkValidPath($(this).val());
                });

                $('.list-group-item').on('click', function () {
                    $('.list-group-item').removeClass('active');
                    $(this).addClass('active');
                    var idxStr = $(this).attr('id');
                    idx = idxStr.substring(4, idxStr.length);
                    showDetail(idx)
                })

                function checkValidPath(path) {
                    $.ajax({
                        url: "api/check/path",
                        type: 'POST',
                        data: '{"path":"' + path + '"}',
                        dataType: 'json',
                        beforeSend: function (xhr) {
                            xhr.overrideMimeType("text/plain; charset=x-user-defined")
                        }
                    }).done(function (response) {
                        if (!response.data) {
                            alert('Not a valid local path');
                            error.path = "Path error";
                            return false
                        }
                    });
                    return true
                }

                $("#details-form").submit(function (e) {
                    e.preventDefault();
                    console.log(error);
                    saveBuDetails()
                });

                function saveBuDetails() {
                    alert('save')
                }
        */
    })
</script>

{{end}}